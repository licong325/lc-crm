# é¡µé¢æˆªå›¾åŠŸèƒ½æŠ€æœ¯å®žçŽ°æ–¹æ¡ˆ

## ðŸŽ¯ **æŠ€æœ¯æž¶æž„æ¦‚è¿°**

é‡‡ç”¨çº¯åŽŸç”ŸJavaScript + Canvas 2D APIå®žçŽ°çš„DOMéåŽ†æˆªå›¾æ–¹æ¡ˆï¼Œæ— éœ€ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ã€‚

## ðŸ”§ **æ ¸å¿ƒæŠ€æœ¯æ ˆ**

### **1. DOMéåŽ†æŠ€æœ¯**

- `document.querySelectorAll('*')` - èŽ·å–é¡µé¢æ‰€æœ‰å…ƒç´ 
- `element.getBoundingClientRect()` - èŽ·å–å…ƒç´ ç²¾ç¡®ä½ç½®å’Œå°ºå¯¸
- `window.getComputedStyle()` - èŽ·å–å…ƒç´ çš„å®žé™…æ¸²æŸ“æ ·å¼
- åŒºåŸŸç¢°æ’žæ£€æµ‹ç®—æ³• - åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é€‰æ‹©åŒºåŸŸå†…

### **2. Canvas 2D ç»˜åˆ¶å¼•æ“Ž**

- `Canvas.getContext('2d')` - èŽ·å–2Dç»˜åˆ¶ä¸Šä¸‹æ–‡
- `ctx.fillRect()` - ç»˜åˆ¶èƒŒæ™¯è‰²å’Œå¡«å……
- `ctx.strokeRect()` - ç»˜åˆ¶è¾¹æ¡†
- `ctx.fillText()` - ç»˜åˆ¶æ–‡æœ¬å†…å®¹
- `ctx.drawImage()` - ç»˜åˆ¶å›¾ç‰‡å…ƒç´ 
- `ctx.save()/ctx.restore()` - çŠ¶æ€ç®¡ç†
- `ctx.clip()` - è£å‰ªåŒºåŸŸæŽ§åˆ¶

### **3. äº‹ä»¶å¤„ç†ç³»ç»Ÿ**

- é¼ æ ‡äº‹ä»¶ï¼š`mousedown`, `mousemove`, `mouseup`
- é”®ç›˜äº‹ä»¶ï¼š`keydown` (ESCå–æ¶ˆåŠŸèƒ½)
- äº‹ä»¶å§”æ‰˜å’ŒåŠ¨æ€ç»‘å®š/è§£ç»‘
- é˜²æŠ–å’ŒèŠ‚æµä¼˜åŒ–

### **4. åæ ‡è®¡ç®—ç³»ç»Ÿ**

```javascript
// è§†å£åæ ‡è½¬æ–‡æ¡£åæ ‡
const documentX = clientX + window.scrollX
const documentY = clientY + window.scrollY

// ç›¸å¯¹åæ ‡è®¡ç®—
const relativeX = elementRect.left - selectionRect.left
const relativeY = elementRect.top - selectionRect.top
```

### **5. æ ·å¼è§£æžå¼•æ“Ž**

- CSSæ ·å¼æå–ï¼š`backgroundColor`, `borderColor`, `fontSize`, `color`
- æ ·å¼å€¼è§£æžï¼š`parseInt()`, `parseFloat()`
- é»˜è®¤å€¼å¤„ç†å’Œå…¼å®¹æ€§é€‚é…
- Z-indexå±‚çº§æŽ’åº

### **6. å¼‚æ­¥ç»˜åˆ¶å¤„ç†**

```javascript
// PromiseåŒ…è£…çš„å›¾ç‰‡ç»˜åˆ¶
const drawImageToCanvas = (ctx, img, rect) => {
  return new Promise((resolve) => {
    try {
      ctx.drawImage(img, rect.x, rect.y, rect.width, rect.height)
      resolve()
    } catch (error) {
      // é™çº§å¤„ç†
      resolve()
    }
  })
}
```

### **7. æ–‡ä»¶å¤„ç†API**

- `canvas.toBlob()` - Canvasè½¬Blobå¯¹è±¡
- `URL.createObjectURL()` - åˆ›å»ºä¸‹è½½é“¾æŽ¥
- `document.createElement('a')` - åŠ¨æ€åˆ›å»ºä¸‹è½½é“¾æŽ¥
- å†…å­˜ç®¡ç†ï¼š`URL.revokeObjectURL()`

## ðŸ— **å®žçŽ°æ­¥éª¤è¯¦è§£**

### **ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæˆªå›¾ç»„ä»¶ç»“æž„**

- Vue 3 Composition APIæž¶æž„
- å“åº”å¼çŠ¶æ€ç®¡ç†
- Element Plus UIç»„ä»¶é›†æˆ

### **ç¬¬äºŒæ­¥ï¼šæ ¸å¿ƒæ•°æ®å’ŒçŠ¶æ€ç®¡ç†**

```javascript
const screenshotData = ref({
  startX: 0,
  startY: 0, // é€‰æ‹©èµ·ç‚¹
  endX: 0,
  endY: 0, // é€‰æ‹©ç»ˆç‚¹
  width: 0,
  height: 0, // é€‰æ‹©åŒºåŸŸå°ºå¯¸
})
```

### **ç¬¬ä¸‰æ­¥ï¼šåŠ¨æ€é®ç½©å±‚åˆ›å»º**

- å…¨å±åŠé€æ˜Žé®ç½©ï¼š`position: fixed; z-index: 9999`
- åŠ¨æ€é€‰æ‹©æ¡†ï¼šè™šçº¿è¾¹æ¡† + åŠé€æ˜ŽèƒŒæ™¯
- å®žæ—¶åæ ‡æ˜¾ç¤ºï¼šè·Ÿéšé¼ æ ‡çš„å°ºå¯¸æç¤º

### **ç¬¬å››æ­¥ï¼šé¼ æ ‡äº¤äº’å¤„ç†**

- æ‹–æ‹½é€‰æ‹©ç®—æ³•
- å®žæ—¶åŒºåŸŸè®¡ç®—å’Œæ›´æ–°
- è¾¹ç•Œæ£€æµ‹å’Œæœ€å°å°ºå¯¸é™åˆ¶

### **ç¬¬äº”æ­¥ï¼šDOMæ‰«æä¸Žå…ƒç´ è¯†åˆ«**

```javascript
// æ ¸å¿ƒç®—æ³•ï¼šåŒºåŸŸå†…å…ƒç´ æ£€æµ‹
const isElementInSelection = (elementRect, selectionRect) => {
  return (
    elementRect.right > selectionRect.left &&
    elementRect.left < selectionRect.right &&
    elementRect.bottom > selectionRect.top &&
    elementRect.top < selectionRect.bottom
  )
}
```

### **ç¬¬å…­æ­¥ï¼šCanvasç»˜åˆ¶å¼•æ“Ž**

- åˆ†å±‚ç»˜åˆ¶ï¼šèƒŒæ™¯ â†’ è¾¹æ¡† â†’ æ–‡æœ¬ â†’ å›¾ç‰‡
- æ ·å¼æ˜ å°„ï¼šCSSæ ·å¼è½¬Canvasç»˜åˆ¶å‚æ•°
- é”™è¯¯é™çº§ï¼šç»˜åˆ¶å¤±è´¥æ—¶çš„å ä½ç¬¦å¤„ç†

### **ç¬¬ä¸ƒæ­¥ï¼šé¢„è§ˆä¸Žå¯¼å‡º**

- Canvasæ•°æ®å±•ç¤º
- PNGæ ¼å¼å¯¼å‡º
- é‡æ–°æˆªå›¾å¾ªçŽ¯

## ðŸŽ¨ **ç»˜åˆ¶ç®—æ³•è¯¦è§£**

### **å…ƒç´ è¿‡æ»¤æœºåˆ¶**

```javascript
// è·³è¿‡ä¸å¯è§å…ƒç´ 
if (style.display === 'none' || style.visibility === 'hidden' || parseFloat(style.opacity) === 0) {
  return
}
```

### **æ–‡æœ¬ç»˜åˆ¶ç®—æ³•**

- å­—ä½“æ ·å¼æ˜ å°„ï¼š`fontSize`, `fontFamily`, `fontWeight`
- æ–‡æœ¬æˆªæ–­å¤„ç†ï¼šè¶…é•¿æ–‡æœ¬è‡ªåŠ¨æ·»åŠ çœç•¥å·
- é¢œè‰²å’Œå¯¹é½æ–¹å¼å¤„ç†

### **å›¾ç‰‡ç»˜åˆ¶å¤„ç†**

- è·¨åŸŸå›¾ç‰‡å¤„ç†
- åŠ è½½å¤±è´¥é™çº§
- å°ºå¯¸é€‚é…å’Œç¼©æ”¾

## ðŸ”§ **å…³é”®æŠ€æœ¯ç‚¹**

### **DOMè½¬Canvasçš„åŽŸç”Ÿå®žçŽ°æ–¹æ¡ˆï¼š**

1. âœ… **é€å…ƒç´ éåŽ†ç»˜åˆ¶**ï¼ˆå½“å‰é‡‡ç”¨ï¼‰- å¤æ‚ä½†å…¼å®¹æ€§å¥½
2. âŒ **SVG + foreignObject** - è·¨åŸŸå’Œæ ·å¼é™åˆ¶
3. âŒ **Canvas drawWindow()** - ä»…Firefoxæ”¯æŒ

### **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**

- `requestAnimationFrame` ä¼˜åŒ–åŠ¨ç”»æµç•…åº¦
- å…ƒç´ è¿‡æ»¤å‡å°‘ä¸å¿…è¦çš„ç»˜åˆ¶
- CanvasçŠ¶æ€ç®¡ç†é¿å…é‡å¤è®¾ç½®
- å†…å­˜ç®¡ç†ï¼šåŠæ—¶æ¸…ç†Canvaså’ŒURLå¯¹è±¡
- äº‹ä»¶èŠ‚æµé¿å…è¿‡åº¦è®¡ç®—

### **å…¼å®¹æ€§å¤„ç†ï¼š**

- å¤šæµè§ˆå™¨Canvas APIé€‚é…
- å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
- æ ·å¼è§£æžå…¼å®¹æ€§
- äº‹ä»¶å¤„ç†å…¼å®¹æ€§

## ðŸš€ **æŠ€æœ¯ä¼˜åŠ¿**

1. **é›¶ä¾èµ–**ï¼šçº¯åŽŸç”Ÿå®žçŽ°ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº“
2. **é«˜å…¼å®¹æ€§**ï¼šæ”¯æŒæ‰€æœ‰çŽ°ä»£æµè§ˆå™¨
3. **å¯æŽ§æ€§å¼º**ï¼šå®Œå…¨å¯å®šåˆ¶çš„ç»˜åˆ¶é€»è¾‘
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šç²¾ç»†çš„æ¸²æŸ“æŽ§åˆ¶
5. **æ‰©å±•æ€§å¥½**ï¼šæ˜“äºŽæ·»åŠ æ–°çš„ç»˜åˆ¶åŠŸèƒ½

## ðŸ“ˆ **å¯ä¼˜åŒ–æ–¹å‘**

1. **CSS3ç‰¹æ•ˆæ”¯æŒ**ï¼šé˜´å½±ã€æ¸å˜ã€å˜æ¢ç­‰
2. **SVGå…ƒç´ æ”¯æŒ**ï¼šçŸ¢é‡å›¾å½¢ç»˜åˆ¶
3. **å­—ä½“åŠ è½½æ£€æµ‹**ï¼šç¡®ä¿è‡ªå®šä¹‰å­—ä½“æ­£ç¡®æ˜¾ç¤º
4. **å¤šé¡µé¢æˆªå›¾**ï¼šæ”¯æŒiframeå’Œè·¨åŸŸå†…å®¹
5. **æ‰¹é‡æˆªå›¾**ï¼šè‡ªåŠ¨åŒ–æˆªå›¾å·¥å…·
